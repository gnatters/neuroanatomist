{<% n=@asset["attrs"].size; @asset.delete("attrs").each do |attr, value| n-=1 %>
  <%= raw attr.inspect %>:<%= raw (value.kind_of?(String) ? value.inspect : (value.kind_of?(Numeric) ? value : JSON.dump(value))) %><%= "," if n > 0 or @asset.size > 0 %><% end %><% n=@asset.size; @asset.to_a.each do |type, values| n-=1 %>
  <%= raw type.inspect %>:<% if type == "shapes"
    %>[<% m = values.size; values.each { |s_id| @shape = @shapes[s_id]; m-=1
    %><%=  render :partial => 'shapes/show', :formets => [:json] %><%= "," if m > 0 %><%
    } %>]<% else %>[<%
    m = values.size; values.each do |asset| @asset = asset; m-=1
      %><%= render :partial => 'asset', :formets => [:json] %><%= "," if m > 0 %><%
    end %>]<%
  end
end %><%= "," if n > 0 %>
}